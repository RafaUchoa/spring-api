<!DOCTYPE html>
<html lang="pt-BR">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Lista de Podutos</title>
</head>
<body>
	<h2>Lista de Produtos</h2>
	<table id="produtosTable" border=1>
		<thead>
			<tr>
				<th>ID</th>
				<th>Nome</th>
				<th>Preço</th>
			</tr>
		</thead>
		<tbody>
		</tbody>
	</table>
	<div id="erroMensagem" style="color:red; display: none;">Erro ao buscar produtos</div>
	<div id="totalProdutos">Total de produtos: 0</div>

	<script>
		function listarProdutos(){
			let pathServer = "http://localhost:8080/produtos";
			console.log('Conectando ao endereço: ' + pathServer);
			fetch(pathServer)
				.then(response => {
					if(!response.ok){
						throw new Error('Erro na rede' + response.status);
					}
					return response.json();
				})
				.then(data => {
					const tableBody = document.getElementById('produtosTable').getElementsByTagName('tbody')[0];
					let totalProdutos = 0;
					data.forEach(produto => {
						console.log("Produto Nome" + produto.nome)
						const row = tableBody.insertRow();
						const cellId = row.insertCell(0);
						const cellNome = row.insertCell(1);
						const cellPreco = row.insertCell(2);

						cellId.textContent = produto.id;
						cellNome.textContent = produto.nome;
						cellPreco.textContent = produto.preco;
						totalProdutos++;
					})
					document.getElementById('totalProdutos').textContent = 'Total de produtos: ' + totalProdutos;
				})
				.catch(error => {
					console.log("Erro ao trazer dados de produtos: ", error );
					document.getElementById('erroMensagem').style.display='block';

				});
		}
		document.addEventListener('DOMContentLoaded', listarProdutos);
	</script>
</body>